<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>餐會桌號查詢</title>
    <style>
      body{
        font-size: 1.5em;
        font-family: Arial, Helvetica, sans-serif;
      }
      h2, h1{
        text-align: center;
      }
      
      form{
        text-align: center;
      }
      input{
        font-size: 1.5em;
        height: 52px;
      }
      button{
        font-size: 1.5em;
      }

    </style>
  </head>
  <body>
    <main>
      <div>
          <form onsubmit="return handleSubmit(event)">
              <h2>請輸入您的票號：</h2>
              <input id='ticketId' type='number' min='1' max='1000' name='ticketId' placeholder='票號' />
              <button id='btn'  disabled>載入中</button>
            </form>
      </div>
      
      <div>
          <h2>您的桌號為：</h2>
          <h1 id='show-result'></h1>
      </div>
     
    </main>


    <script charset="utf-8">
      let matrix = []
      
      function parse(entries) { // input: the data.entry from the google spreadsheet response
        for (const entry of entries) {
           const row = entry.gs$cell.row - 1 // Row starts at 1 
           const col = entry.gs$cell.col - 1 // Col starts at 1 
           const value = entry.gs$cell.inputValue
           if (!matrix[row]) {
             matrix[row] = []
           }
           matrix[row][col] = value
        }
        return matrix
      }

      const url = "https://spreadsheets.google.com/feeds/cells/1hBVlw66Z71xaIN536PjwROu44dfAKe2l6wKXD2jafog/1/public/full?alt=json"
      fetch(url)
        .then(response => response.json())
        .then(data => {
          console.log(data)
          console.log(parse(data.feed.entry))
          document.getElementById('btn').innerText='查詢'
          document.getElementById('btn').disabled=false
        })

      let deskId = null

      function handleSubmit(event){
        event.preventDefault() 
        let ticketId = document.getElementById('ticketId').value
        console.log('tecketID', ticketId)
        const found = matrix.find(function(element){
                    return element[0] == ticketId
                  })
        console.log('found',found)
        if(!found || !found[1]){
          deskId = '請聯繫工作人員'
        }else{
          deskId = `${found[1]}桌`
        }
        
        console.log('deskId', deskId)
        document.getElementById('show-result').innerText=deskId
        
      }

    </script>
  </body>
</html>
